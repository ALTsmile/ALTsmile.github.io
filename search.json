[{"title":"在hexo的NexT主题上上传音乐并设播放器","url":"/2025/12/25/%E5%9C%A8hexo%E7%9A%84NexT%E4%B8%BB%E9%A2%98%E4%B8%8A%E4%B8%8A%E4%BC%A0%E9%9F%B3%E4%B9%90%E5%B9%B6%E8%AE%BE%E6%92%AD%E6%94%BE%E5%99%A8/","content":"本来想用网易云外链简单明了的，结果发现有些歌曲网易云要vip，我就想着能不能上传本地音乐到仓库，然后让AI写个简单的播放器功能\n1. 下载Aplayer插件并配置\n下载Aplayer插件\n\nnpm install hexo-tag-aplayer --save\n\n\n然后在NexT的配置文件_config.yml中在最后一行输入以下配置信息\n\naplayer:\n  cdn: https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js\n  style_cdn: https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css\n  meting: true # 如果要使用 MetingJS\n\n2. 配置一个音乐播放器这一步比较麻烦  \n\n配置NexT的_config.yml\n\n我选择把播放器寄存在侧边栏，让侧边栏调用。所以找到custom_file_path，把sidebar前的#去掉，然后写上路径source/_data/sidebar-music.njk\n\n创建存放歌曲和歌曲封面的文件夹\n\n这一步我选择把歌曲和歌曲封面分别存放到source/music和source/music-cover\n\n配置音乐播放器\n\n在source/_data下新建一个文件sidebar-music.njk，然后找AI生成代码，我这边已经调试了很久，把代码复制粘贴上去即可\n&lt;style&gt;\n/* 音乐播放器容器 - 固定在右下角 */\n.music-player-container &#123;\n  position: fixed;\n  bottom: 100px;\n  right: 30px;\n  z-index: 9999;\n  width: 80px;\n  height: 80px;\n&#125;\n\n/* 圆形音乐封面 */\n.music-avatar &#123;\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  overflow: hidden;\n  position: relative;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  z-index: 10000;\n&#125;\n\n.music-avatar:hover &#123;\n  transform: scale(1.05);\n  box-shadow: 0 6px 20px rgba(0,0,0,0.2);\n&#125;\n\n.music-avatar-img &#123;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  filter: brightness(0.7);\n  transition: filter 0.3s ease;\n&#125;\n\n.music-avatar:hover .music-avatar-img &#123;\n  filter: brightness(1);\n&#125;\n\n/* 播放按钮覆盖层 */\n.play-overlay &#123;\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0,0,0,0.3);\n  border-radius: 50%;\n  opacity: 1;\n  transition: opacity 0.3s ease, background 0.3s ease;\n&#125;\n\n.music-avatar:hover .play-overlay &#123;\n  background: rgba(0,0,0,0.2);\n&#125;\n\n.play-btn &#123;\n  background: rgba(255,255,255,0.9);\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #667eea;\n  font-size: 18px;\n  transition: all 0.3s ease;\n  border: none;\n  cursor: pointer;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n&#125;\n\n.play-btn:hover &#123;\n  background: white;\n  transform: scale(1.1);\n  box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n&#125;\n\n/* 音乐控制面板 */\n.music-panel &#123;\n  position: fixed;\n  width: 280px;\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 8px 30px rgba(0,0,0,0.15);\n  opacity: 0;\n  visibility: hidden;\n  transform: translateY(-20px);\n  transition: all 0.3s ease;\n  z-index: 9998;\n  overflow: hidden;\n  pointer-events: none;\n  max-height: 350px;\n  display: flex;\n  flex-direction: column;\n&#125;\n\n.music-panel.show &#123;\n  opacity: 1;\n  visibility: visible;\n  transform: translateY(0);\n  pointer-events: auto;\n&#125;\n\n/* 播放列表 */\n.playlist-section &#123;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  border-bottom: 1px solid #f0f0f0;\n&#125;\n\n.playlist-header &#123;\n  padding: 12px 15px 8px 15px;\n  background: white;\n  border-bottom: 1px solid #f0f0f0;\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  flex-shrink: 0;\n&#125;\n\n.playlist-title &#123;\n  font-size: 12px;\n  color: #999;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  font-weight: 500;\n  margin: 0;\n&#125;\n\n.playlist-items &#123;\n  flex: 1;\n  overflow-y: auto;\n  padding: 0 10px 10px 10px;\n  max-height: 180px;\n&#125;\n\n.playlist-items &#123;\n  overscroll-behavior: contain;\n&#125;\n\n.playlist-items::-webkit-scrollbar &#123;\n  width: 6px;\n&#125;\n\n.playlist-items::-webkit-scrollbar-track &#123;\n  background: #f5f5f5;\n  border-radius: 3px;\n&#125;\n\n.playlist-items::-webkit-scrollbar-thumb &#123;\n  background: #ccc;\n  border-radius: 3px;\n&#125;\n\n.playlist-items::-webkit-scrollbar-thumb:hover &#123;\n  background: #999;\n&#125;\n\n.playlist-item &#123;\n  display: flex;\n  align-items: center;\n  padding: 6px 8px;\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  margin-bottom: 2px;\n  min-height: 36px;\n  user-select: none;\n&#125;\n\n.playlist-item:hover &#123;\n  background: #f8f9fa;\n&#125;\n\n.playlist-item.active &#123;\n  background: #e6f7ff;\n  color: #1890ff;\n&#125;\n\n.playlist-num &#123;\n  width: 18px;\n  height: 18px;\n  background: #f5f5f5;\n  color: #666;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 10px;\n  font-weight: 500;\n  margin-right: 8px;\n  flex-shrink: 0;\n&#125;\n\n.playlist-item.active .playlist-num &#123;\n  background: #1890ff;\n  color: white;\n&#125;\n\n.playlist-info &#123;\n  flex: 1;\n  min-width: 0;\n  margin-right: 5px;\n&#125;\n\n.playlist-track &#123;\n  font-size: 12px;\n  font-weight: 500;\n  color: #333;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  line-height: 1.2;\n&#125;\n\n.playlist-artist &#123;\n  font-size: 10px;\n  color: #999;\n  margin-top: 1px;\n  line-height: 1.2;\n&#125;\n\n.playlist-duration &#123;\n  font-size: 10px;\n  color: #999;\n  flex-shrink: 0;\n&#125;\n\n/* 控制栏 */\n.controls-section &#123;\n  padding: 12px 15px;\n  background: #fafafa;\n  flex-shrink: 0;\n  border-top: 1px solid #eee;\n&#125;\n\n/* 当前播放信息 */\n.current-track &#123;\n  margin-bottom: 10px;\n  text-align: center;\n&#125;\n\n.track-name &#123;\n  font-size: 13px;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 2px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  line-height: 1.2;\n&#125;\n\n.track-artist &#123;\n  font-size: 11px;\n  color: #666;\n  line-height: 1.2;\n&#125;\n\n/* 控制按钮组 */\n.controls-group &#123;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 6px;\n  margin-top: 8px;\n&#125;\n\n.control-btn &#123;\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  border: none;\n  background: white;\n  color: #666;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  font-size: 12px;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n&#125;\n\n.control-btn:hover &#123;\n  background: #667eea;\n  color: white;\n  transform: translateY(-1px);\n  box-shadow: 0 3px 8px rgba(102, 126, 234, 0.4);\n&#125;\n\n.control-btn.main &#123;\n  width: 36px;\n  height: 36px;\n  font-size: 14px;\n  background: linear-gradient(135deg, #667eea, #764ba2);\n  color: white;\n  box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);\n&#125;\n\n.control-btn.main:hover &#123;\n  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);\n&#125;\n\n/* 进度条 */\n.progress-container &#123;\n  margin-top: 8px;\n  position: relative;\n&#125;\n\n.progress-bar &#123;\n  height: 4px;\n  background: #e8e8e8;\n  border-radius: 2px;\n  cursor: pointer;\n  position: relative;\n  user-select: none;\n  touch-action: none;\n&#125;\n\n.progress &#123;\n  height: 100%;\n  background: linear-gradient(90deg, #667eea, #764ba2);\n  width: 0%;\n  border-radius: 2px;\n  position: relative;\n  transition: width 0.1s linear;\n  pointer-events: none;\n&#125;\n\n/* 进度条拖拽点 */\n.progress::after &#123;\n  content: &#x27;&#x27;;\n  position: absolute;\n  right: -5px;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 10px;\n  height: 10px;\n  background: white;\n  border: 2px solid #667eea;\n  border-radius: 50%;\n  opacity: 0;\n  transition: opacity 0.2s, transform 0.2s;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n  pointer-events: none;\n&#125;\n\n.progress-bar:hover .progress::after,\n.progress-bar.dragging .progress::after &#123;\n  opacity: 1;\n  transform: translateY(-50%) scale(1);\n&#125;\n\n.time-info &#123;\n  display: flex;\n  justify-content: space-between;\n  font-size: 9px;\n  color: #999;\n  margin-top: 4px;\n  user-select: none;\n&#125;\n\n/* 播放模式指示器 */\n.play-mode-indicator &#123;\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  margin-right: 6px;\n  background: #667eea;\n  transition: background 0.3s ease;\n  flex-shrink: 0;\n&#125;\n\n.play-mode-indicator.list &#123; background: #667eea; &#125;\n.play-mode-indicator.random &#123; background: #f5222d; &#125;\n&lt;/style&gt;\n\n&lt;script&gt;\n// 等待页面加载完成后初始化播放器\ndocument.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123;\n  // 检查是否已经存在播放器容器\n  if (document.querySelector(&#x27;.music-player-container&#x27;)) &#123;\n    console.log(&#x27;音乐播放器已存在&#x27;);\n    return;\n  &#125;\n  \n  // 自动计算正确的路径\n  function getCorrectPath(relativePath) &#123;\n    const currentPath = window.location.pathname;\n    const currentUrl = window.location.href;\n    \n    // 如果当前页面是 _posts 目录下的文章页面\n    if (currentPath.includes(&#x27;/_posts/&#x27;) || currentPath.includes(&#x27;/categories/&#x27;) || \n        currentPath.includes(&#x27;/tags/&#x27;) || currentPath.includes(&#x27;/about/&#x27;)) &#123;\n      // 这些页面在 source 目录下，需要返回上级目录\n      return &#x27;../&#x27; + relativePath;\n    &#125;\n    \n    // 如果是文章详情页（通常是 /年/月/日/文章名/ 格式）\n    const pathParts = currentPath.split(&#x27;/&#x27;).filter(p =&gt; p);\n    if (pathParts.length &gt;= 4 &amp;&amp; /^\\d&#123;4&#125;$/.test(pathParts[0]) &amp;&amp; /^\\d&#123;2&#125;$/.test(pathParts[1])) &#123;\n      // 计算需要返回多少级目录才能到 source 目录\n      const levelsUp = pathParts.length;\n      return &#x27;../&#x27;.repeat(levelsUp) + relativePath;\n    &#125;\n    \n    // 主页或其他页面，使用相对路径\n    return relativePath;\n  &#125;\n  \n  // 创建播放器容器\n  const container = document.createElement(&#x27;div&#x27;);\n  container.className = &#x27;music-player-container&#x27;;\n  container.innerHTML = `\n    &lt;!-- 圆形音乐封面 --&gt;\n    &lt;div class=&quot;music-avatar&quot; id=&quot;music-avatar&quot;&gt;\n      &lt;img src=&quot;$&#123;getCorrectPath(&#x27;music-cover/Undying Macula.jpg&#x27;)&#125;&quot; alt=&quot;专辑封面&quot; class=&quot;music-avatar-img&quot; id=&quot;avatar-img&quot; onerror=&quot;this.src=&#x27;data:image/svg+xml,&lt;svg xmlns=\\&quot;http://www.w3.org/2000/svg\\&quot; width=\\&quot;80\\&quot; height=\\&quot;80\\&quot; viewBox=\\&quot;0 0 24 24\\&quot;&gt;&lt;rect width=\\&quot;24\\&quot; height=\\&quot;24\\&quot; fill=\\&quot;%23667eea\\&quot;/&gt;&lt;text x=\\&quot;12\\&quot; y=\\&quot;16\\&quot; font-family=\\&quot;Arial\\&quot; font-size=\\&quot;12\\&quot; fill=\\&quot;white\\&quot; text-anchor=\\&quot;middle\\&quot;&gt;Music&lt;/text&gt;&lt;/svg&gt;&#x27;&quot;&gt;\n      &lt;div class=&quot;play-overlay&quot;&gt;\n        &lt;button class=&quot;play-btn&quot; id=&quot;avatar-play-btn&quot; title=&quot;播放/暂停&quot;&gt;\n          &lt;i class=&quot;fa fa-play&quot; id=&quot;avatar-play-icon&quot;&gt;&lt;/i&gt;\n        &lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;!-- 音乐控制面板 --&gt;\n    &lt;div class=&quot;music-panel&quot; id=&quot;music-panel&quot;&gt;\n      &lt;!-- 播放列表 --&gt;\n      &lt;div class=&quot;playlist-section&quot;&gt;\n        &lt;div class=&quot;playlist-header&quot;&gt;\n          &lt;div class=&quot;playlist-title&quot;&gt;播放列表&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;playlist-items&quot; id=&quot;playlist&quot;&gt;\n          &lt;!-- 播放列表项将通过JavaScript动态生成 --&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n\n      &lt;!-- 控制栏 --&gt;\n      &lt;div class=&quot;controls-section&quot;&gt;\n        &lt;!-- 当前播放信息 --&gt;\n        &lt;div class=&quot;current-track&quot;&gt;\n          &lt;div class=&quot;track-name&quot; id=&quot;current-track-name&quot;&gt;Undying Macula&lt;/div&gt;\n          &lt;div class=&quot;track-artist&quot; id=&quot;current-track-artist&quot;&gt;Ashrount&lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;!-- 进度条 --&gt;\n        &lt;div class=&quot;progress-container&quot;&gt;\n          &lt;div class=&quot;progress-bar&quot; id=&quot;progress-bar&quot;&gt;\n            &lt;div class=&quot;progress&quot; id=&quot;progress&quot;&gt;&lt;/div&gt;\n          &lt;/div&gt;\n          &lt;div class=&quot;time-info&quot;&gt;\n            &lt;span id=&quot;current-time&quot;&gt;00:00&lt;/span&gt;\n            &lt;span id=&quot;total-time&quot;&gt;02:43&lt;/span&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;!-- 控制按钮 --&gt;\n        &lt;div class=&quot;controls-group&quot;&gt;\n          &lt;button class=&quot;control-btn&quot; id=&quot;mode-btn&quot; title=&quot;播放模式&quot;&gt;\n            &lt;i class=&quot;fa fa-random&quot; id=&quot;mode-icon&quot;&gt;&lt;/i&gt;\n          &lt;/button&gt;\n          &lt;button class=&quot;control-btn&quot; id=&quot;prev-btn&quot; title=&quot;上一首&quot;&gt;\n            &lt;i class=&quot;fa fa-step-backward&quot;&gt;&lt;/i&gt;\n          &lt;/button&gt;\n          &lt;button class=&quot;control-btn main&quot; id=&quot;main-play-btn&quot; title=&quot;播放/暂停&quot;&gt;\n            &lt;i class=&quot;fa fa-play&quot; id=&quot;main-play-icon&quot;&gt;&lt;/i&gt;\n          &lt;/button&gt;\n          &lt;button class=&quot;control-btn&quot; id=&quot;next-btn&quot; title=&quot;下一首&quot;&gt;\n            &lt;i class=&quot;fa fa-step-forward&quot;&gt;&lt;/i&gt;\n          &lt;/button&gt;\n          &lt;div class=&quot;play-mode-indicator&quot; id=&quot;play-mode-indicator&quot;&gt;&lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  `;\n  \n  // 插入到body末尾\n  document.body.appendChild(container);\n  \n  // 初始化播放器\n  initMusicPlayer();\n&#125;);\n\n// 全局变量\nlet ap = null;\nlet isPlaying = false;\nlet currentVolume = 0.7;\nlet playMode = &#x27;list&#x27;; // 只有 &#x27;list&#x27; 和 &#x27;random&#x27; 两种模式\nlet panelTimeout = null;\nlet isPanelVisible = false;\nlet isSeeking = false;\nlet isDraggingProgress = false;\nlet lastRandomIndex = -1;\nlet currentTrackIndex = 0;\n\n// 自动计算当前页面的基础路径\nfunction getBasePath() &#123;\n  const currentPath = window.location.pathname;\n  const currentUrl = window.location.href;\n  \n  // 如果当前页面是 _posts 目录下的文章页面\n  if (currentPath.includes(&#x27;/_posts/&#x27;) || currentPath.includes(&#x27;/categories/&#x27;) || \n      currentPath.includes(&#x27;/tags/&#x27;) || currentPath.includes(&#x27;/about/&#x27;)) &#123;\n    // 这些页面在 source 目录下，需要返回上级目录\n    return &#x27;../&#x27;;\n  &#125;\n  \n  // 如果是文章详情页（Hexo格式：/年/月/日/文章名/）\n  const pathParts = currentPath.split(&#x27;/&#x27;).filter(p =&gt; p);\n  if (pathParts.length &gt;= 4 &amp;&amp; /^\\d&#123;4&#125;$/.test(pathParts[0]) &amp;&amp; /^\\d&#123;2&#125;$/.test(pathParts[1])) &#123;\n    // 计算需要返回多少级目录才能到根目录\n    const levelsUp = pathParts.length;\n    return &#x27;../&#x27;.repeat(levelsUp);\n  &#125;\n  \n  // 主页或其他页面，使用相对路径\n  return &#x27;./&#x27;;\n&#125;\n\n// 音乐列表 - 使用动态路径\nconst musicList = [\n  &#123;\n    name: &#x27;Undying Macula&#x27;,\n    artist: &#x27;Ashrount&#x27;,\n    url: &#x27;music/Undying Macula.mp3&#x27;,\n    cover: &#x27;music-cover/Undying Macula.jpg&#x27;,\n    duration: &#x27;02:43&#x27;,\n  &#125;,\n  &#123;\n    name: &#x27;AFTER PANDORA&#x27;,\n    artist: &#x27;削除&#x27;,\n    url: &#x27;music/AFTER PANDORA.mp3&#x27;,\n    cover: &#x27;music-cover/AFTER PANDORA.png&#x27;,\n    duration: &#x27;04:06&#x27;,\n  &#125;,\n  &#123;\n    name: &#x27;Androgynos (Full Phase)&#x27;,\n    artist: &#x27;BlackY&#x27;,\n    url: &#x27;music/Androgynos (Full Phase).mp3&#x27;,\n    cover: &#x27;music-cover/Androgynos (Full Phase).jpg&#x27;,\n    duration: &#x27;04:56&#x27;,\n  &#125;,\n  &#123;\n    name: &#x27;Immutable&#x27;,\n    artist: &#x27;Juggernaut.&#x27;,\n    url: &#x27;music/Immutable.mp3&#x27;,\n    cover: &#x27;music-cover/Immutable.png&#x27;,\n    duration: &#x27;05:25&#x27;,\n  &#125;,\n];\n\nfunction initMusicPlayer() &#123;\n  // 创建隐藏的 APlayer 容器\n  const playerContainer = document.createElement(&#x27;div&#x27;);\n  playerContainer.id = &#x27;aplayer-hidden-container&#x27;;\n  playerContainer.style.display = &#x27;none&#x27;;\n  document.body.appendChild(playerContainer);\n  \n  // 获取基础路径\n  const basePath = getBasePath();\n  \n  // 修正音乐文件路径\n  const correctedMusicList = musicList.map(track =&gt; &#123;\n    return &#123;\n      ...track,\n      url: basePath + track.url,\n      cover: basePath + track.cover\n    &#125;;\n  &#125;);\n  \n  // 简化：始终使用列表循环\n  ap = new APlayer(&#123;\n    container: document.getElementById(&#x27;aplayer-hidden-container&#x27;),\n    audio: correctedMusicList,\n    theme: &#x27;#667eea&#x27;,\n    loop: &#x27;all&#x27;, // 始终使用全部循环\n    order: &#x27;list&#x27;,\n    preload: &#x27;auto&#x27;,\n    volume: currentVolume,\n    mutex: true,\n    lrcType: 0,\n    fixed: false,\n    mini: false,\n    autoplay: false,\n    controls: false\n  &#125;);\n  \n  // 事件监听\n  ap.on(&#x27;play&#x27;, () =&gt; &#123;\n    isPlaying = true;\n    updatePlayButton();\n    updateAvatarPlayButton();\n  &#125;);\n\n  ap.on(&#x27;pause&#x27;, () =&gt; &#123;\n    isPlaying = false;\n    updatePlayButton();\n    updateAvatarPlayButton();\n  &#125;);\n\n  ap.on(&#x27;canplay&#x27;, () =&gt; &#123;\n    updateTrackInfo();\n  &#125;);\n  \n  // 监听 timeupdate 更新进度\n  ap.on(&#x27;timeupdate&#x27;, () =&gt; &#123;\n    if (!isSeeking &amp;&amp; !isDraggingProgress) &#123;\n      updateProgress();\n    &#125;\n  &#125;);\n  \n  ap.on(&#x27;loadedmetadata&#x27;, () =&gt; &#123;\n    updateProgress();\n    const totalTime = document.getElementById(&#x27;total-time&#x27;);\n    if (ap.audio.duration &amp;&amp; !isNaN(ap.audio.duration)) &#123;\n      totalTime.textContent = formatTime(ap.audio.duration);\n    &#125;\n  &#125;);\n  \n  // 监听歌曲切换\n  ap.on(&#x27;listswitch&#x27;, (index) =&gt; &#123;\n    currentTrackIndex = index.item;\n    updateTrackInfo();\n    updateActivePlaylistItem(index.item);\n  &#125;);\n  \n  // 初始化 UI\n  renderPlaylist();\n  setupEventListeners();\n  positionPanel();\n  updatePlayModeUI();\n  hidePanel();\n&#125;\n\nfunction setupEventListeners() &#123;\n  const avatar = document.getElementById(&#x27;music-avatar&#x27;);\n  const panel = document.getElementById(&#x27;music-panel&#x27;);\n  const progressBar = document.getElementById(&#x27;progress-bar&#x27;);\n  const playlistItems = document.getElementById(&#x27;playlist&#x27;);\n  const avatarBtn = document.getElementById(&#x27;avatar-play-btn&#x27;);\n  const modeBtn = document.getElementById(&#x27;mode-btn&#x27;);\n  const prevBtn = document.getElementById(&#x27;prev-btn&#x27;);\n  const mainBtn = document.getElementById(&#x27;main-play-btn&#x27;);\n  const nextBtn = document.getElementById(&#x27;next-btn&#x27;);\n\n  if (!avatar || !panel || !progressBar) &#123;\n    console.error(&#x27;播放器元素未找到&#x27;);\n    return;\n  &#125;\n\n  // 滚动传递问题\n  playlistItems.addEventListener(&#x27;wheel&#x27;, function(e) &#123;\n    const isAtBottom = this.scrollHeight - this.scrollTop &lt;= this.clientHeight + 1;\n    const isAtTop = this.scrollTop === 0;\n    \n    if (isAtBottom &amp;&amp; e.deltaY &gt; 0) &#123;\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    &#125;\n    \n    if (isAtTop &amp;&amp; e.deltaY &lt; 0) &#123;\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    &#125;\n    \n    e.stopPropagation();\n  &#125;, &#123; passive: false &#125;);\n\n  // 封面鼠标事件\n  avatar.addEventListener(&#x27;mouseenter&#x27;, function(e) &#123;\n    e.stopPropagation();\n    showPanel();\n  &#125;);\n\n  avatar.addEventListener(&#x27;mouseleave&#x27;, function(e) &#123;\n    e.stopPropagation();\n    if (!isPanelVisible) &#123;\n      hidePanel();\n    &#125;\n  &#125;);\n\n  // 进度条事件处理\n  progressBar.addEventListener(&#x27;mousedown&#x27;, function(e) &#123;\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (!ap.audio || !ap.audio.duration) return;\n    \n    isDraggingProgress = true;\n    progressBar.classList.add(&#x27;dragging&#x27;);\n    isSeeking = true;\n    \n    const rect = progressBar.getBoundingClientRect();\n    const x = e.clientX;\n    const percent = Math.max(0, Math.min(1, (x - rect.left) / rect.width));\n    \n    updateProgressDisplay(percent);\n    \n    document.addEventListener(&#x27;mousemove&#x27;, handleProgressDragMove);\n    document.addEventListener(&#x27;mouseup&#x27;, handleProgressDragEnd);\n  &#125;);\n\n  progressBar.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    \n    if (!ap.audio || !ap.audio.duration) return;\n    \n    const rect = progressBar.getBoundingClientRect();\n    const x = e.clientX;\n    const percent = Math.max(0, Math.min(1, (x - rect.left) / rect.width));\n    const targetTime = percent * ap.audio.duration;\n    \n    isSeeking = true;\n    ap.seek(targetTime);\n    updateProgressDisplay(percent);\n    \n    if (isPlaying) &#123;\n      setTimeout(() =&gt; &#123;\n        ap.play();\n      &#125;, 10);\n    &#125;\n    \n    setTimeout(() =&gt; &#123;\n      isSeeking = false;\n    &#125;, 100);\n  &#125;);\n\n  // 按钮事件\n  avatarBtn.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    togglePlayPause();\n  &#125;);\n\n  modeBtn.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    changePlayMode();\n  &#125;);\n\n  prevBtn.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    previousTrack();\n  &#125;);\n\n  mainBtn.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    togglePlayPause();\n  &#125;);\n\n  nextBtn.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    e.stopPropagation();\n    nextTrack();\n  &#125;);\n\n  // 面板鼠标事件\n  panel.addEventListener(&#x27;mouseenter&#x27;, function(e) &#123;\n    e.stopPropagation();\n    isPanelVisible = true;\n    if (panelTimeout) &#123;\n      clearTimeout(panelTimeout);\n    &#125;\n  &#125;);\n\n  panel.addEventListener(&#x27;mouseleave&#x27;, function(e) &#123;\n    e.stopPropagation();\n    isPanelVisible = false;\n    panelTimeout = setTimeout(hidePanel, 300);\n  &#125;);\n\n  window.addEventListener(&#x27;scroll&#x27;, positionPanel);\n  window.addEventListener(&#x27;resize&#x27;, positionPanel);\n  \n  document.addEventListener(&#x27;click&#x27;, function(e) &#123;\n    const avatar = document.getElementById(&#x27;music-avatar&#x27;);\n    const panel = document.getElementById(&#x27;music-panel&#x27;);\n    if (!avatar.contains(e.target) &amp;&amp; !panel.contains(e.target)) &#123;\n      hidePanel();\n    &#125;\n  &#125;);\n&#125;\n\n// 进度条拖拽移动\nfunction handleProgressDragMove(e) &#123;\n  if (!isDraggingProgress || !ap.audio || !ap.audio.duration) return;\n  \n  e.preventDefault();\n  e.stopPropagation();\n  \n  const progressBar = document.getElementById(&#x27;progress-bar&#x27;);\n  const rect = progressBar.getBoundingClientRect();\n  const x = e.clientX;\n  const percent = Math.max(0, Math.min(1, (x - rect.left) / rect.width));\n  \n  updateProgressDisplay(percent);\n&#125;\n\n// 进度条拖拽结束\nfunction handleProgressDragEnd(e) &#123;\n  if (!isDraggingProgress || !ap.audio || !ap.audio.duration) return;\n  \n  e.preventDefault();\n  e.stopPropagation();\n  \n  isDraggingProgress = false;\n  const progressBar = document.getElementById(&#x27;progress-bar&#x27;);\n  progressBar.classList.remove(&#x27;dragging&#x27;);\n  \n  const rect = progressBar.getBoundingClientRect();\n  const x = e.clientX;\n  const percent = Math.max(0, Math.min(1, (x - rect.left) / rect.width));\n  const targetTime = percent * ap.audio.duration;\n  \n  ap.seek(targetTime);\n  \n  if (isPlaying) &#123;\n    ap.pause();\n    setTimeout(() =&gt; &#123;\n      ap.play();\n    &#125;, 10);\n  &#125;\n  \n  updateProgressDisplay(percent);\n  \n  document.removeEventListener(&#x27;mousemove&#x27;, handleProgressDragMove);\n  document.removeEventListener(&#x27;mouseup&#x27;, handleProgressDragEnd);\n  \n  setTimeout(() =&gt; &#123;\n    isSeeking = false;\n  &#125;, 100);\n&#125;\n\nfunction updateProgressDisplay(percent) &#123;\n  const progress = document.getElementById(&#x27;progress&#x27;);\n  const currentTimeEl = document.getElementById(&#x27;current-time&#x27;);\n  \n  if (progress) &#123;\n    progress.style.width = `$&#123;percent * 100&#125;%`;\n  &#125;\n  \n  if (currentTimeEl &amp;&amp; ap.audio &amp;&amp; ap.audio.duration) &#123;\n    const targetTime = percent * ap.audio.duration;\n    currentTimeEl.textContent = formatTime(targetTime);\n  &#125;\n&#125;\n\nfunction updateProgress() &#123;\n  if (!ap.audio || !ap.audio.duration || isNaN(ap.audio.duration) || isSeeking || isDraggingProgress) &#123;\n    return;\n  &#125;\n  \n  const currentTime = ap.audio.currentTime || 0;\n  const duration = ap.audio.duration || 0;\n  const percent = duration &gt; 0 ? (currentTime / duration) * 100 : 0;\n  \n  const progress = document.getElementById(&#x27;progress&#x27;);\n  if (progress) &#123;\n    progress.style.width = `$&#123;percent&#125;%`;\n  &#125;\n  \n  const currentTimeEl = document.getElementById(&#x27;current-time&#x27;);\n  if (currentTimeEl) currentTimeEl.textContent = formatTime(currentTime);\n&#125;\n\nfunction showPanel() &#123;\n  const panel = document.getElementById(&#x27;music-panel&#x27;);\n  if (panel) &#123;\n    panel.classList.add(&#x27;show&#x27;);\n    positionPanel();\n    isPanelVisible = true;\n    \n    if (panelTimeout) &#123;\n      clearTimeout(panelTimeout);\n    &#125;\n  &#125;\n&#125;\n\nfunction hidePanel() &#123;\n  const panel = document.getElementById(&#x27;music-panel&#x27;);\n  if (panel) &#123;\n    panel.classList.remove(&#x27;show&#x27;);\n    isPanelVisible = false;\n  &#125;\n&#125;\n\nfunction positionPanel() &#123;\n  const avatar = document.getElementById(&#x27;music-avatar&#x27;);\n  const panel = document.getElementById(&#x27;music-panel&#x27;);\n  if (!avatar || !panel) return;\n  \n  const avatarRect = avatar.getBoundingClientRect();\n  const viewportWidth = window.innerWidth;\n  const viewportHeight = window.innerHeight;\n  const panelWidth = 280;\n  const panelHeight = 320;\n  \n  let left = avatarRect.right + 10;\n  let top = avatarRect.top;\n  \n  if (left + panelWidth &gt; viewportWidth - 20) &#123;\n    left = avatarRect.left - panelWidth - 10;\n  &#125;\n  \n  if (left &lt; 20) &#123;\n    left = 20;\n  &#125;\n  \n  if (top + panelHeight &gt; viewportHeight - 20) &#123;\n    top = viewportHeight - panelHeight - 20;\n  &#125;\n  \n  if (top &lt; 20) &#123;\n    top = 20;\n  &#125;\n  \n  panel.style.left = left + &#x27;px&#x27;;\n  panel.style.top = top + &#x27;px&#x27;;\n&#125;\n\nfunction renderPlaylist() &#123;\n  const playlistEl = document.getElementById(&#x27;playlist&#x27;);\n  if (!playlistEl) return;\n  \n  playlistEl.innerHTML = &#x27;&#x27;;\n  \n  const basePath = getBasePath();\n  const correctedMusicList = musicList.map(track =&gt; (&#123;\n    ...track,\n    url: basePath + track.url,\n    cover: basePath + track.cover\n  &#125;));\n  \n  correctedMusicList.forEach((track, index) =&gt; &#123;\n    const item = document.createElement(&#x27;div&#x27;);\n    item.className = &#x27;playlist-item&#x27;;\n    if (index === 0) item.classList.add(&#x27;active&#x27;);\n    item.innerHTML = `\n      &lt;div class=&quot;playlist-num&quot;&gt;$&#123;index + 1&#125;&lt;/div&gt;\n      &lt;div class=&quot;playlist-info&quot;&gt;\n        &lt;div class=&quot;playlist-track&quot;&gt;$&#123;track.name&#125;&lt;/div&gt;\n        &lt;div class=&quot;playlist-artist&quot;&gt;$&#123;track.artist&#125;&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=&quot;playlist-duration&quot;&gt;$&#123;track.duration&#125;&lt;/div&gt;\n    `;\n    item.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;\n      e.stopPropagation();\n      playTrack(index);\n    &#125;);\n    playlistEl.appendChild(item);\n  &#125;);\n&#125;\n\nfunction playTrack(index) &#123;\n  currentTrackIndex = index;\n  \n  if (playMode === &#x27;random&#x27;) &#123;\n    lastRandomIndex = index;\n  &#125;\n  \n  ap.list.switch(index);\n  ap.play();\n  updateActivePlaylistItem(index);\n  updateTrackInfo();\n  showPanel();\n&#125;\n\nfunction updateActivePlaylistItem(index) &#123;\n  document.querySelectorAll(&#x27;.playlist-item&#x27;).forEach((item, i) =&gt; &#123;\n    item.classList.toggle(&#x27;active&#x27;, i === index);\n  &#125;);\n&#125;\n\nfunction togglePlayPause() &#123;\n  if (isPlaying) &#123;\n    ap.pause();\n  &#125; else &#123;\n    ap.play();\n  &#125;\n  showPanel();\n&#125;\n\nfunction updatePlayButton() &#123;\n  const mainIcon = document.getElementById(&#x27;main-play-icon&#x27;);\n  const mainBtn = document.getElementById(&#x27;main-play-btn&#x27;);\n  if (isPlaying) &#123;\n    if (mainIcon) mainIcon.className = &#x27;fa fa-pause&#x27;;\n    if (mainBtn) mainBtn.title = &#x27;暂停&#x27;;\n  &#125; else &#123;\n    if (mainIcon) mainIcon.className = &#x27;fa fa-play&#x27;;\n    if (mainBtn) mainBtn.title = &#x27;播放&#x27;;\n  &#125;\n&#125;\n\nfunction updateAvatarPlayButton() &#123;\n  const avatarIcon = document.getElementById(&#x27;avatar-play-icon&#x27;);\n  const avatarBtn = document.getElementById(&#x27;avatar-play-btn&#x27;);\n  if (isPlaying) &#123;\n    if (avatarIcon) avatarIcon.className = &#x27;fa fa-pause&#x27;;\n    if (avatarBtn) avatarBtn.title = &#x27;暂停&#x27;;\n  &#125; else &#123;\n    if (avatarIcon) avatarIcon.className = &#x27;fa fa-play&#x27;;\n    if (avatarBtn) avatarBtn.title = &#x27;播放&#x27;;\n  &#125;\n&#125;\n\nfunction previousTrack() &#123;\n  if (playMode === &#x27;random&#x27;) &#123;\n    let randomIndex;\n    do &#123;\n      randomIndex = Math.floor(Math.random() * musicList.length);\n    &#125; while (musicList.length &gt; 1 &amp;&amp; randomIndex === lastRandomIndex);\n    \n    lastRandomIndex = randomIndex;\n    playTrack(randomIndex);\n  &#125; else &#123;\n    ap.skipBack();\n    if (!isPlaying) ap.play();\n  &#125;\n  updateTrackInfo();\n  showPanel();\n&#125;\n\nfunction nextTrack() &#123;\n  if (playMode === &#x27;random&#x27;) &#123;\n    let randomIndex;\n    do &#123;\n      randomIndex = Math.floor(Math.random() * musicList.length);\n    &#125; while (musicList.length &gt; 1 &amp;&amp; randomIndex === lastRandomIndex);\n    \n    lastRandomIndex = randomIndex;\n    playTrack(randomIndex);\n  &#125; else &#123;\n    ap.skipForward();\n    if (!isPlaying) ap.play();\n  &#125;\n  updateTrackInfo();\n  showPanel();\n&#125;\n\nfunction changePlayMode() &#123;\n  // 只有两种模式：列表循环和随机播放\n  const modes = [\n    &#123; id: &#x27;list&#x27;, name: &#x27;列表循环&#x27;, icon: &#x27;fa-list-ol&#x27; &#125;,\n    &#123; id: &#x27;random&#x27;, name: &#x27;随机播放&#x27;, icon: &#x27;fa-random&#x27; &#125;\n  ];\n  \n  const currentIndex = modes.findIndex(mode =&gt; mode.id === playMode);\n  const nextIndex = (currentIndex + 1) % modes.length;\n  playMode = modes[nextIndex].id;\n  \n  if (playMode === &#x27;random&#x27;) &#123;\n    // 初始化随机播放\n    lastRandomIndex = -1;\n  &#125;\n  \n  updatePlayModeUI();\n  showPanel();\n&#125;\n\nfunction updatePlayModeUI() &#123;\n  const modeBtn = document.getElementById(&#x27;mode-btn&#x27;);\n  const modeIcon = document.getElementById(&#x27;mode-icon&#x27;);\n  const indicator = document.getElementById(&#x27;play-mode-indicator&#x27;);\n  \n  let title = &#x27;&#x27;, icon = &#x27;&#x27;, indicatorClass = &#x27;&#x27;;\n  \n  if (playMode === &#x27;list&#x27;) &#123;\n    title = &#x27;列表循环&#x27;;\n    icon = &#x27;fa-list-ol&#x27;;\n    indicatorClass = &#x27;list&#x27;;\n  &#125; else if (playMode === &#x27;random&#x27;) &#123;\n    title = &#x27;随机播放&#x27;;\n    icon = &#x27;fa-random&#x27;;\n    indicatorClass = &#x27;random&#x27;;\n  &#125;\n  \n  if (modeBtn) modeBtn.title = title;\n  if (modeIcon) modeIcon.className = &#x27;fa &#x27; + icon;\n  if (indicator) indicator.className = &#x27;play-mode-indicator &#x27; + indicatorClass;\n&#125;\n\nfunction updateTrackInfo() &#123;\n  const basePath = getBasePath();\n  const correctedMusicList = musicList.map(track =&gt; (&#123;\n    ...track,\n    url: basePath + track.url,\n    cover: basePath + track.cover\n  &#125;));\n  \n  const current = correctedMusicList[ap.list.index];\n  if (!current) return;\n  \n  const trackName = document.getElementById(&#x27;current-track-name&#x27;);\n  const trackArtist = document.getElementById(&#x27;current-track-artist&#x27;);\n  const avatarImg = document.getElementById(&#x27;avatar-img&#x27;);\n  const totalTime = document.getElementById(&#x27;total-time&#x27;);\n  \n  if (trackName) trackName.textContent = current.name;\n  if (trackArtist) trackArtist.textContent = current.artist;\n  if (avatarImg) &#123;\n    avatarImg.src = current.cover;\n  &#125;\n  if (totalTime) totalTime.textContent = current.duration;\n  \n  updateActivePlaylistItem(ap.list.index);\n&#125;\n\nfunction formatTime(seconds) &#123;\n  if (isNaN(seconds) || seconds === 0) return &#x27;00:00&#x27;;\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `$&#123;mins.toString().padStart(2, &#x27;0&#x27;)&#125;:$&#123;secs.toString().padStart(2, &#x27;0&#x27;)&#125;`;\n&#125;\n&lt;/script&gt;\n\n&lt;!-- 引入 APlayer --&gt;\n&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css&quot;&gt;\n&lt;script src=&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js&quot;&gt;&lt;/script&gt;\n\n最后得到的结果就是现在右下角的那个小播放器了，然后要加自己的歌曲需要在音乐列表那里手动添加音乐信息，格式是相同的。音乐信息可以包含歌词文件，Aplayer是支持歌词功能的，但这里我没有调试，要添加歌词功能的可能还得让AI调试一下\n\n  \n\n\n最后四连\nhexo clean &amp;&amp; hexo g &amp;&amp; hexo d &amp;&amp; hexo s\n\n\n注意：\n因不明原因，在本地上部署的这个静态网站无法移动进度条，但是Github上的进度条功能正常\n\n遇到的问题：\n本来是想加一个单曲循环功能的，但是这个AI怎么都调试不好，无奈放弃了，你们可以试着调教一下\n","tags":["hexo"]}]